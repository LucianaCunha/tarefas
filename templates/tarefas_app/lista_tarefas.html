{% extends 'base.html' %}
{% block title %}Minhas Tarefas{% endblock %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <!-- Nova Tarefa -->
        <div class="card mb-4 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Nova Tarefa</h5>
                <form method="POST" class="row g-3">
                    {% csrf_token %}
                    <div class="col-md-7">
                        <input type="text" name="titulo" class="form-control" placeholder="O que precisa fazer?" required>
                    </div>
                    <div class="col-md-3">
                        <input type="date" name="prazo" class="form-control">
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary w-100">Adicionar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Lista -->
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">Tarefas <span class="badge bg-secondary">{{ tarefas|length }}</span></h5>
            </div>
            <ul class="list-group list-group-flush">
                {% for t in tarefas %}
                <li class="list-group-item {% if t.prazo_vencido and not t.concluida %}bg-danger bg-opacity-10{% endif %}">
                    <div class="d-flex align-items-center">
                        <form method="POST" action="{% url 'toggle_concluida' t.pk %}" class="me-3">
                            {% csrf_token %}
                            <input type="checkbox" class="form-check-input" style="width: 1.5rem; height: 1.5rem; cursor: pointer;" 
                                   {% if t.concluida %}checked{% endif %}
                                   onchange="this.form.submit()">
                        </form>
                        <div class="flex-grow-1 {% if t.concluida %}task-done{% endif %}">
                            <strong class="{% if t.prazo_vencido and not t.concluida %}text-danger{% endif %}">
                                {{ t.titulo }}
                            </strong>
                            {% if t.prazo %}
                            <small class="d-block {% if t.prazo_vencido and not t.concluida %}text-danger fw-bold{% else %}text-muted{% endif %}">
                                <i class="bi bi-calendar-event"></i> Prazo: {{ t.prazo|date:"d/m/Y" }}
                                {% if t.prazo_vencido and not t.concluida %}
                                    <span class="badge bg-danger ms-2">VENCIDA</span>
                                {% endif %}
                            </small>
                            {% endif %}
                        </div>
                        <form method="POST" action="{% url 'deletar_tarefa' t.pk %}"
                              onsubmit="return confirm('Tem certeza que deseja excluir esta tarefa?');">
                            {% csrf_token %}
                            <button class="btn btn-sm btn-outline-danger" type="submit">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                </li>
                {% empty %}
                <li class="list-group-item text-center text-muted py-4">
                    <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                    Nenhuma tarefa ainda.
                </li>
                {% endfor %}
            </ul>
            <div class="card-footer text-center small text-muted">
                <i class="bi bi-calendar-check"></i> Hoje: {{ hoje|date:"d/m/Y" }}
            </div>
        </div>
    </div>
</div>
{% endblock %}